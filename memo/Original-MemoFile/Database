MongoDB

ë‹¤ëª©ì ìš©ì´ê³ , documentë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œë‹¤.
document-based

ì¼ë°˜ì ìœ¼ë¡œ, database document-basedê°€ ì•„ë‹Œ sql-basedì´ë‹¤.

í–‰ ê¸°ë°˜ì´ë¼ í•  ìˆ˜ ìˆëŠ”ë°, ì—‘ì…€ ì‹œíŠ¸ë¥¼ ìƒìƒí•´ë³´ì.

MongoDBì— ì €ì¥í•˜ëŠ” ê²ƒë“¤ì€ JSON-like-documentì´ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ í–‰ìœ¼ë¡œ ëœ ë°ì´í„°ë¥¼ ì €ì¥í•  í•„ìš”ê°€ ì—†ë‹¤.

package.jsonì²˜ëŸ¼ ì €ì¥ëœë‹¤ê³  ë³´ë©´ ëœë‹¤.

ê²Œë”ê°€, mongoDBëŠ” document ë‚´ë¶€ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

ê²€ìƒ‰, create, delete, edit ...

mongodbì„¤ì¹˜

mongodb.comìœ¼ë¡œ ê°€ì„œ Docsë¥¼ ëˆŒëŸ¬ì£¼ë©´, Serverë¼ëŠ”ê²Œ ìˆë‹¤.

Installationì´ ìˆë‹¤. Install MongoDB Community Editionì„ í´ë¦­

ë‚˜ì™€ìˆëŠ” ëª…ë ¹ì–´ë¥¼ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰.

mongoose

mongooseëŠ” node.jsì™€ mogoDBë¥¼ ì´ì–´ì£¼ëŠ” ë‹¤ë¦¬ê°€ ëœë‹¤.

javaScriptë¥¼ ì ìœ¼ë©´ mongooseê°€ mongoDBë¡œ ê±´ë„¤ì¤€ë‹¤.

validationí•  ìˆ˜ ìˆê³ , query buildingí•  ìˆ˜ ìˆê³ , hookë„ ìˆê³ , ì•„ì£¼ ë§ì€ ê²ƒ ê°€ëŠ¥.

ìš°ë¶„íˆ¬ 20.04 ë²„ì „ ì“°ì‹œëŠ” ë¶„ì€ ì°¸ê³ í•˜ì‹œê³ . mongdb ìµœì‹ ë²„ì „ìœ¼ë¡œ ë‹¤ìš´í•˜ì„¸ìš”
ìš°ë¶„íˆ¬ ë²„ì „í™•ì¸ì€ lsb_release -dc
ëª½ê³ db ë²„ì „í™•ì¸ì€ mongd --version 

í˜¹ì‹œë‚˜ ë²„ì „ì„ ì˜ëª» ì„¤ì¹˜í•´ì„œ ì¬ì„¤ì¹˜ í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ì€
sudo apt-get remove mongodb
sudo apt-get autoremove
ì…ë ¥í•´ì„œ ì‚­ì œí•´ì£¼ì„¸ìš”
sudo apt list --installed | grep mongo ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ í™•ì¸í•˜ëŠ” ëª…ë ¹ì–´ ì¸ë°ìš”
ì…ë ¥í›„ mongoë¡œ ì‹œì‘ ë˜ëŠ” ê²ƒì´ ì—†ë‹¤ë©´ ì œê±° ì„±ê³µí•˜ì‹  ê²ë‹ˆë‹¤.

ì„¤ì¹˜ë°©ë²•ì€ https://velog.io/@seungsang00/Ubuntu-MongoDB-%EC%84%A4%EC%B9%98%ED%95%98%EA%B8%B0-Ubuntu-20.04 ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

ì‹œì‘ sudo service mongodb start ->ì„±ê³µí•˜ë©´ ìš°ì¸¡ì— [ok] ì‹¤íŒ¨ë©´ [fail]ì´ ëœ¹ë‹ˆë‹¤.
mongoë¥¼ ì…ë ¥í•´ì„œ mongo shellì— ì ‘ì†
ì¤‘ì§€ëŠ” sudo service mongodb stop

ë§Œì•½ start í–ˆëŠ”ë° failì´ ëœ¬ë‹¤ë©´ cd / ì…ë ¥í•´ì„œ rootë¡œ ê°€ì‹  í›„ì—
sudo cat var/log/mongodb/mongodb.log ë¥¼ ì…ë ¥í•˜ë©´ ë¡œê·¸ê°€ ëœ¨ëŠ”ë°,
ë§¨ í•˜ë‹¨ì— aborting after fassert() failure ê°€ ë‚˜ì˜¨ë‹¤ë©´
sudo rm /tmp/mongodb-27017.sock ì…ë ¥ í›„ ë‹¤ì‹œ start í•˜ì„¸ìš”.

+ë§Œì•½ì— sudo service mongodb startë¥¼ í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ mongod ë‚˜ mongo ë¥¼ ì…ë ¥í•˜ë©´ ìœ„ì— ì ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤

-------------------------------------

mongoë¥¼ ì…ë ¥í•˜ë©´ mongoDB shellì´ë‘ ì—°ê²°ì„ í•´ì¤€ë‹¤.

helpë¥¼ ì…ë ¤í•´ì„œ ëª…ë ¹ì–´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

mongooseë¥¼ ì„¤ì¹˜í•˜ì.

npm i mongoose

server.jsìˆëŠ” í´ë”ì— db.jsë¥¼ ìƒì„±í•´ì£¼ê³  ì»´í“¨í„°ì— ì‹¤í•´ì˜¤ë””ê³  ìˆëŠ” mongo databaseì— ì—°ê²°í•´ ì¤„ ê²ƒì´ë‹¤.

mongo ëª…ë ¹ì–´ë¥¼ consoleì—ì„œ ì‹¤í–‰ì‹œì¼œì„œ, urlì„ ë°›ì•„ì™€ì•¼ í•œë‹¤.

db.js

import mongoose from "mongoose";

mongoose.connect("mongodb://127.0.0.1:27017/nameofdatabase")

nameofdatabaseì—” databaseì´ë¦„ì´ ë“¤ì–´ê°€ë©´ ëœë‹¤.

ìƒì„±ëœ db.jsëŠ” ì•„ì§ í•˜ëŠ”ê²Œ ì—†ë‹¤. ì™œëƒí•˜ë©´ ì„œë²„(server.js)ì— ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

server.js

import "./db.js";

ì´í›„ dbì—ì„œ optionsì„ ì£¼ë¼ê³  warningì´ ëœ¨ë©´ optionì„ ì£¼ë©´ëœë‹¤.

datbaseì—ì„œ eventê°€ ë°œìƒí•  ê²ƒì„ ìƒê°í•´ë³´ë©´, errorê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë‹ˆ ë¬´ìŠ¨ ì—ëŸ¬ê°€ ëœ¨ëŠ”ì§€ ì¶œë ¥ì‹œì¼œì£¼ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ í•˜ê³ , connectionì„ ì—¬ëŠ” ë•Œë„ ìƒê°í•´ ë³¼ ìˆ˜ ìˆìœ¼ë‹ˆ, console.logë¥¼ í•´ì¤€ë‹¤.

db.js

import mongoose from "mongoose";

mongoose.connect("mongodb://127.0.0.1:27017/wetube", {
  useNewUrlParser: true,
  useUnifiedTopology: true,
});

const db = mongoose.connection;

const handleOpen = () => console.log("âœ… Connected to DB");
const handleError = (error) => console.log("âŒ DB Error", error);

db.on("error", handleError);
db.once("open", handleOpen);


on vs once

onì€ ì—¬ëŸ¬ë²ˆ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤. ì¦‰, í´ë¦­í•  ë•Œë§ˆë‹¤ ë°œìƒí•˜ëŠ” ê²ƒì´ë¼ê³  ìƒê°í•˜ë©´ ë˜ê³ , onceëŠ” ì˜¤ë¡œì§€ í•œë²ˆë§Œ ë°œìƒí•œë‹¤.

CRUDì„ ëª©í‘œë¡œí•œë‹¤.

CëŠ” create(ìƒì„±), Rì€ read(ì½ê¸°), UëŠ” update(ìˆ˜ì •), DëŠ” delete(ì‚­ì œ)ë¥¼ ì˜ë¯¸í•œë‹¤.

mongooseì—ê²Œ, ìš°ë¦¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„°ë“¤ì´ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ì•Œë ¤ì¤˜ì•¼í•œë‹¤.

ë”°ë¼ì„œ ê·¸ê²ƒì„ models/Video.jsë¥¼ í†µí•´ì„œ í•  ê²ƒì´ë‹¤. ë°ì´í„°ì˜ ê´€ì ì—ì„œ, Videoê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ì•Œë ¤ì£¼ëŠ” íŒŒì¼ì´ë‹¤.

Video Modelì„ ë§Œë“¤ê¸° ìœ„í•´ì„  mongooseë¥¼ importí•´ì¤˜ì•¼í•œë‹¤.

modelì„ ìƒì„±í•˜ê¸° ì „ì— modelì˜ í˜•íƒœë¥¼ ì •ì˜í•´ ì¤„ í•„ìš”ê°€ ìˆë‹¤.

schemaë¼ê³  ì•Œë ¤ì ¸ ìˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ë°ì´í„°ë¥¼ ë„£ëŠ”ê²ƒì´ ì•„ë‹Œ, í˜•ì‹ë§Œ ë„£ì–´ì£¼ë©´ ëœë‹¤.

models/Video.js

import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
  title: String,
  description: String,
  createdAt: Date,
  hashtags: [{ type: String }],
  meta: {
    views: Number,
    rating: Number,
  },
});

const Video = mongoose.model("Video", videoSchema);
export default Video;


Arrayí˜•ì‹ì„ ì§€ì •í•  ë•Œ typeë„ ìœ„ì™€ê°™ì´ ì§€ì •í•´ ì¤„ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í•´ë„ ë™ì¼í•˜ë‹¤.

title: {type: String},

modelë§Œë“œëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ëœë‹¤.

const Video = mongoose.model("Video", videoSchema);

ê·¸ í›„ì— exportí•´ì£¼ê³  ì„œë²„ì—ì„œ importë¥¼ í•´ì£¼ë©´ ëœë‹¤.

cf) server.jsì— importë¥¼ í•˜ë‹¤ë³´ë‹ˆê¹ ì•ìœ¼ë¡œë„ ë” ë§ì€ ë‚´ìš©ì´ ì¶”ê°€ë  ê²ƒ ê°™ê³  ì´ê²ƒì€ ì„œë²„ì™€ ê´€ë ¨ìˆëŠ” ì½”ë“œê°€ ì•„ë‹ˆë‹¤. ê·¸ë˜ì„œ ë¶„ë¦¬í•´ì„œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ init.jsë¥¼ ë§Œë“ ë‹¤.

serverì˜ ê²½ìš° expressëœ ê²ƒë“¤ê³¼ serverì˜ configurationì— ê´€ë ¨ëœ ì½”ë“œë§Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ ì¡Œë‹¤.

databaseë‚˜ modelsê°™ì€ ê²ƒë“¤ì„ importí•˜ê¸° ìœ„í•¨ì´ ì•„ë‹ˆë‹¤. ê·¸ë˜ì„œ init.js ì™€ server.jsë¡œ êµ¬ë¶„í•œë‹¤.

init.js

import "./db";
import "./models/Video";
import app from "./server";

const PORT = 4000;

const handleListening = () =>
  console.log(`âœ… Server listenting on port http://localhost:${PORT} ğŸš€`);

app.listen(PORT, handleListening);



server.js

import express from "express";
import morgan from "morgan";
import globalRouter from "./routers/globalRouter";
import userRouter from "./routers/userRouter";
import videoRouter from "./routers/videoRouter";

const app = express();
const logger = morgan("dev");

app.set("view engine", "pug");
app.set("views", process.cwd() + "/src/views");

app.use(logger);
app.use(express.urlencoded({ extended: true }));
app.use("/", globalRouter);
app.use("/users", userRouter);
app.use("/videos", videoRouter);

export default app;

databaseë‚´ videoì— ëŒ€í•œ ì ‘ê·¼ì€ ì–´ë ¤ìš¸ê¹Œ?

video Modelë‹¤ë£¨ëŠ”ê²ƒì€ controllerì—ì„œ í•˜ë©´ëœë‹¤.

ë¨¼ì € íŒŒì¼ì—ì„œ importë¥¼ í•´ì¤€ë‹¤.

ê·¸ë¦¬ê³  databaseì™€ ì—°ê²°í•´ì¤˜ì•¼í•œë‹¤. ( Documentë¥¼ ì°¸ê³ í•˜ì | query )
Vidoe.find()
ë‘ê°€ì§€ í™œìš© ë°©ë²•ì´ ìˆëŠ”ë° í•˜ë‚˜ëŠ” callback functionì„ ì‚¬ìš©í•˜ê±°ë‚˜, promiseë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

callbackì´ ë¬´ì—‡ì´ëƒ

callbackì´ë€ ë¬´ì–¸ê°€ê°€ ë°œìƒí•˜ê³  ë‚œ ë‹¤ìŒ í˜¸ì¶œë˜ëŠ” functionì„ ë§í•œë‹¤.

ì¦‰ ì‹¤í–‰ì´ ë˜ëŠ”ê²ƒì„ ê¸°ë‹¤ë ¤ì•¼ë§Œ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

Videoê°™ì€ ê²½ìš°ì—ë„ javaScriptë‚´ì—ì„œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ì™¸ë¶€ì—ì„œ ë°ì´í„°ë¥¼ êº¼ë‚´ì˜¤ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ë°ì´í„°ê°€ ì™„ì „íˆ ì „ì†¡ë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼í•œë‹¤. ê·¸ ê³¼ì •ì—ì„œ ì˜¤ë¥˜ê°€ ë‚  ìˆ˜ë„ ìˆëŠ” ê²ƒì´ë‹¤.

ë‹¤ì‹œ ëŒì•„ê°€ì„œ Video.find()ì—ì„œ í•„ìš”í•œ ì¸ìëŠ” configurationì´ë‘ í˜¸ì¶œí•  functionì´ í•„ìš”í•˜ë‹¤.

Video.find({}, (error, document) => {};);

ì—¬ê¸°ì„œ ì¤‘ê´„í˜¸ëŠ” search termsë¥¼ ë‚˜íƒ€ë‚´ëŠ”ë°, search termsê°€ ë¹„ì–´ìˆìœ¼ë©´ ëª¨ë“  í˜•ì‹ì„ ì°¾ëŠ”ë‹¤ëŠ” ê²ƒì„ ëœ»í•œë‹¤.
ì¦‰, ëª¨ë“  í˜•íƒœì˜ ë¹„ë””ì˜¤ë¥¼ ì°¾ëŠ” ê²ƒì´ë‹¤. (ë³¸ë˜ëŠ” ì €ìë¦¬ì— condition?ì´ ë“¤ì–´ê°€ì•¼ í•œë‹¤.)

mongooseëŠ” ì´ ë¶€ë¶„ì„ databaseì—ì„œ ë¶ˆëŸ¬ì˜¬ ê²ƒì´ë‹¤.

Video.find({},

databaseê°€ ë°˜ì‘ì„ í•œë‹¤ë©´, mongooseëŠ” (error, document) => {};)ì´ functionì„ ì‹¤í–‰í•  ê²ƒì´ë‹¤.

ê·¸ ë‹¤ìŒ mongooseëŠ” errì™€ documentì˜ ê°’ì„ ë¶ˆëŸ¬ì˜¬ê²ƒì´ë‹¤.

ì—¬ê¸°ì„œ ëˆˆì—¬ê²¨ ë³¼ ê²ƒì´ ìˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œê°€ ì§œì ¸ìˆë‹¤ê³  í•˜ì.

export const home = (req, res) => {
	Video.find({}, (error, videos) => {
		console.log("error", error);
		console.log("video", videos);
	});
	console.log("hello");
	return res.render("home", { pageTitle: "Home", videos: [] });
}

ì¶œë ¥ìˆœì„œë¥¼ ë³´ë©´ error -> videos -> "hello" ì¼ ê²ƒ ê°™ì§€ë§Œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ì•˜ë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 17-18-05.png

ìš°ë¦¬ì˜ loggerëŠ” requestê°€ ì™„ì„±ë˜ë©´ ì¶œë ¥ì´ ë¼ì•¼ í•œë‹¤.

"hello"ê°€ ë‚˜ì˜¨ ì‹œì ì—ì„œ ì—°ê²°ì´ ëœê²ƒì´ê³ , templateì„ renderí•œ ë‹¤ìŒ errorsì™€ videosê°€ ì¶œë ¥ì´ ëœê²ƒì´ë‹¤.	

ê¼­ ê¸°ì–µí•´ì•¼ ë  ë¶€ë¶„ì€ ìœ ì €ê°€ pageë¥¼ requestí•˜ê³  "hello"ë¥¼ ì¶œë ¥í•œ ë’¤ render ê³¼ì •ì„ ê±°ì³ì•¼ loggerë¥¼ ì–»ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤. 

ìœ ì €ê°€ ìš”ì²­í•´ì„œ ë°›ì€ responseë¥¼ ë³´ë©´ ì € ë§ì€ ìš°ë¦¬ê°€ responseë¥¼ ìš”ì²­í•´ì„œ ë°›ì€ ë‹¤ìŒ ë‹¤ì‹œ ì „ì†¡í–ˆë‹¤ëŠ” ë§ì´ë‹¤.

renderì™€ respond ê³¼ì • ì´í›„ì— console.log(error)ì´ë“ ê°€ ì¶œë ¥ë˜ëŠ”ê²ƒ.

ì¢€ ë” ì§ê´€ì ìœ¼ë¡œ ë³´ì´ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í›„ ì‹¤í–‰í•´ë³´ì.

export const home = (req, res) => {
  console.log("Starting Search");
  Video.find({}, (error, videos) => {
    console.log("error", error);
    console.log("video", videos);
    console.log("Finished Search");
  });
  console.log("I should be the last one");
  return res.render("home", { pageTitle: "Home", videos: [] });
};

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 17-27-00.png

ì´ ë¶€ë¶„ì„ ì‘ìš©í•´ ë³¼ ìˆ˜ ìˆë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•œë‹¤.

export const home = (req, res) => {
  console.log("Start");
  Video.find({}, (error, videos) => {
    console.log("Finished");
    return res.render("home", { pageTitle: "Home", videos });
  });
  console.log("I finish first");
};
ì´ì œ datbaseê²€ìƒ‰ì´ ëë‚˜ì•¼ renderingì´ ì‹œì‘ëœë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 17-32-11.png

databaseì˜ ê²€ìƒ‰ì´ ëë‚˜ê¸° ì „ì— renderingì´ ë˜ëŠ”ê²ƒì„ ë°©ì§€í–ˆë‹¤.

í•˜ì§€ë§Œ functionì•ˆì— functionì„ ë„£ì–´ì•¼ ë˜ëŠ”ê±° ê²ƒì´ ë²ˆê±°ë¡­ë‹¤.

ë˜í•œ ì½”ë“œë¥¼ ìì„¸íˆ ì‚´í´ë³´ìë©´, ì €ê²ƒì€ ê²°êµ­ì— home functionì—ì„  returnì´ ì—†ëŠ” ê²ƒì´ë‹¤.

return ìì²´ëŠ” í•´ë‹¹ functionì„ ì¢…ë£Œì‹œì¼œì£¼ëŠ”ë°, ê·¸ê²ƒì´ functionì•ˆì— functionì— ìˆë‹¤ë©´ ì•ˆì—ìˆëŠ” functionì´ì¢…ë£Œê°€ ë˜ëŠ” ê²ƒì´ë‹¤.

ê·¸ë˜ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²ƒì´ promiseì´ë‹¤.

promiseëŠ” callbackì˜ ìµœì‹ ë²„ì „ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

export const home = async (req, res) => {
  try {
    console.log("I start");
    const videos = await Video.find({});
    console.log("I finish");
    console.log(videos);
    return res.render("home", { pageTitle: "Home", videos });
  } catch(error) {
    return res.render("server-error", {error});
  }
};

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 17-36-55.png

awaitë¥¼ findì•ì— ì ìœ¼ë©´ findëŠ” ë„¤ê°€ callbackì„ í•„ìš”ë¡œ í•˜ì§€ ì•Šë‹¤ëŠ” ê±¸ ì•Œê²Œ ë˜ëŠ”ê±°ë‹¤.

ì—¬ê¸°ì„œ error ì¸ìê°€ ì‚¬ë¼ì§„ ê²ƒì„ í•´ê²°í•˜ê¸° ìœ„í•´ try catchë¬¸ì„ ì‚¬ìš©í•œë‹¤.

awaitì˜ ëŒ€ë‹¨í•œ ì ì€ databaseë¥¼ ê¸°ë‹¤ë ¤ì£¼ê¸° ë•Œë¬¸ì´ë‹¤. 

asyncì™€ awaitì˜ ìµœëŒ€ ì¥ì ì€ ì§ê´€ì ì´ë¼ëŠ” ê²ƒì´ë‹¤.

javascriptê°€ ì–´ë””ì„œ ì–´ë–»ê²Œ ê¸°ë‹¤ë¦¬ëŠ”ì§€ ë°”ë¡œ ì•Œ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì–´ë”œ ê°€ì§€ ì•Šê³  awaitê°€ ìˆëŠ” ë¶€ë¶„ì—ì„œ ê³„ì† ë‹¤ ê°€ì ¸ì˜¬ ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì¤€ë‹¤.

ì½”ë”© ê·œì¹™ìƒ awaitëŠ” functionì•ˆì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•œë°,
í•´ë‹¹ functionì´ asynchronousì¼ ë•Œë§Œ ê°€ëŠ¥í•˜ë‹¤.

Userê°€ ë¹„ë””ì˜¤ë¥¼ ì—…ë¡œë“œí•  ë•Œ Schemaì˜ ë°ì´í„°ë¥¼ ë³´ë‚´ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ë§ì´ë‹¤.

![postUploadê²°ê³¼](./screenshot/postUploadê²°ê³¼.png)


ì—…ë¡œë“œ í˜ì´ì§€ë¥¼ Schema êµ¬ì„±ìš”ì†Œì— ë§ê²Œ ìˆ˜ì •í•´ì¤˜ì•¼í•œë‹¤.

upload.pug

extends base.pug

block content 
    form(method="POST") 
        input(type="text", placehloder="Title", name="title", required)
        input(type="text", placehloder="Description", name="description", required)
        input(type="text", placehloder="Hashtags, separated by comma.", name="hashtags",required)
        input(type="submit", value="Upload Video")
        
ë¹„ë””ì˜¤ë¥¼ ë§Œë“œëŠ” ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

ìš°ë¦¬ëŠ” documentë¥¼ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤.

documentëŠ” ë°ì´í„°ë¥¼ ê°€ì§„ ë¹„ë””ì˜¤ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤. ê·¸ë¦¬ê³  documentë¥¼ databaseì— ì €ì¥í•´ì•¼ í•œë‹¤.

video objectë¥¼ ë§Œë“œëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì´ ëœë‹¤.

videoController.js

export const postUpload = (req, res) => {
  const { title, description, hashtags } = req.body;
  const video = new Video({
    title,
    description,
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    createdAt: Date.now(),
    meta: {
      views: 0,
      rating: 0,
    },
  });
  console.log(video);
  return res.redirect("/");
};


hashtagsë¥¼ ë³´ë©´ ,ë¡œ êµ¬ë¶„í•˜ì—¬ string => Arrayë¡œ ë°”ê¿”ì¤€ í›„ map()í•¨ìˆ˜ë¥¼ í†µí•´ì„œ #word í˜•íƒœë¡œ ë§Œë“¤ì–´ ì¤€ë‹¤.

ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 19-35-58.png

mongooseê°€ idë¥¼ ë¶€ì—¬í•´ì¤€ë‹¤.

objectëŠ” documentì²˜ëŸ¼ IDê°€ ìˆì–´ì•¼í•˜ê¸° ë•Œë¬¸ì´ë‹¤. ì•„ì§ DBì—ëŠ” ì¶”ê°€ê°€ ë˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.

Schemaì—ì„œ ì„¤ì •í•´ë‘” ê²ƒì€ metaì•ˆì— viewsì™€ ratingì€ Numberì´ì—¬ì•¼ í•œë‹¤. ë§Œì•½ Stringí˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë³´ë‚´ë©´ ì–´ë–»ê²Œ ë ê²ƒì¸ê°€?

metaê°€ ìƒì„±ë˜ì§€ ì•ŠëŠ”ë‹¤.

ì¦‰, Mongooseê°€ ë°ì´í„° íƒ€ì…ì˜ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë„ì™€ì£¼ê³  ìˆëŠ” ê²ƒì´ë‹¤.

videoê°€ mongoose modelì¸ ë•ì— ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆë‹¤.

video.save();

saveëŠ” promiseë¥¼ returní•´ì£¼ëŠ”ë° saveì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì¤˜ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

ê·¸ë˜ì„œ awaitì™€ asyncë¥¼ ì¨ì¤˜ì•¼ í•œë‹¤.

video.save()ë¥¼ ë³´ë©´ ì €ì¥ëœ documentë¥¼ return í•´ì£¼ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì´ë„ í•  ìˆ˜ ìˆë‹¤.

const dbVideo = await video.save()
console.log(dbVideo);

ìµœì¢…ì ìœ¼ë¡œ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ëœë‹¤.

controller.js

export const postUpload = async (req, res) => {
  const { title, description, hashtags } = req.body;
  const video = new Video({
    title,
    description,
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    createdAt: Date.now(),
    meta: {
      views: 0,
      rating: 0,
    },
  });
  await video.save();
  return res.redirect("/");
};


ì´ë ‡ê²Œ í•˜ê³  upload pageê°€ì„œ í•˜ë‚˜ë¥¼ ì¶”ê°€í•˜ë©´ homeí™”ë©´ì— ëœ¨ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 19-49-45.png

terminalë¡œ ê°€ì„œ mongo ë¡œ ê°€ì„œ show dbsë¥¼ ë³´ë©´ ìƒˆë¡œìš´ databaseê°€ ìƒì„±ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

use tatabaseName 

-> show collections

collectionsì€ documnetì˜ ë¬¶ìŒì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ videoë¥¼ ë§Œë“¤ì–´ë„ ëœë‹¤.

controller.js

export const postUpload = async (req, res) => {
  const { title, description, hashtags } = req.body;
  try { await Video.create({
    title,
    description,
    hashtags: hashtags.split(",").map((word) => `#${word}`),
    createdAt: Date.now(),
    meta: {
      views: 0,
      rating: 0,
    },
  }); catch {
  }
  return res.redirect("/");
};

try - catchëŠ” ì¨ë„ ë˜ê³  ì•ˆì¨ë„ ëœë‹¤.

ì—¬ê¸°ì„œ ë§Œì•½ ë°ì´í„°ë¥¼ í•˜ë‚˜ ë¹„ì›Œë†“ê³  ì‚¬ìš©í•˜ë©´ ì—ëŸ¬ê°€ ë‚ ê¹Œ?
ì˜ˆë¥¼ ë“¤ì–´ createdAt ì„ ì§€ì›Œë†“ê³  ë°ì´í„°ë¥¼ ìƒì„±í•´ì„œ dbì— ë„£ì–´ì£¼ë©´ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚ ê¹Œ?

ë‹µì€ NOë‹¤.

ê·¸ ì´ìœ ëŠ” Schemaì—ì„œ requiredë¥¼ ì•ˆí•´ì¤¬ê¸° ë•Œë¬¸ì´ë‹¤.

models/Video

import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
  title: String,
  description: String,
  createdAt: {type:Date, required: true},
  hashtags: [{ type: String }],
  meta: {
    views: Number,
    rating: Number,
  },
});

const Video = mongoose.model("Video", videoSchema);
export default Video;


ì´ëŸ°ì‹ìœ¼ë¡œ ë§ì´ë‹¤.

ì´ë ‡ê²Œ í•˜ê³  createdAtì„ ì§€ì›Œë†“ê³  ë°ì´í„°ë¥¼ ì „ì†¡í•˜ë©´ ë¬´í•œ ë¡œë”©ì´ ê±¸ë¦´ ê²ƒì´ë‹¤.

why? responseë¥¼ ëª»í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

javascript Errorë¡œ ì¸í•´ì„œ await Video.create() ì´ë¶€ë¶„ì—ì„œ ë©ˆì¶°ì„œì´ë‹¤.

ê·¸ë˜ì„œ ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.

export const postUpload = async (req, res) => {
  const { title, description, hashtags } = req.body;
  try {
    await Video.create({
      title,
      description,
      hashtags: hashtags.split(",").map((word) => `#${word}`),
      meta: {
        views: 0,
        rating: 0,
      },
    });
    return res.redirect("/");
  } catch (error) {
    return res.render("upload", {
      pageTitle: "Upload Video",
      errorMessage: error._message,
    });
  }
};

ì´ë ‡ê²Œ í•˜ê³  upload.pugë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.

uplooad.pug

extends base.pug

block content
    if errorMessage 
        span=errorMessage
    form(method="POST")
        input(placeholder="Title", required, type="text", name="title")
        input(placeholder="Description", required, type="text", name="description")
        input(placeholder="Hashtags, separated by comma.", required, type="text", name="hashtags")
        input(type="submit", value="Upload Video")

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì˜ ìƒê°í•´ë³´ë©´, videoë¥¼ ë§Œë“¤ë•Œ ë§ˆë‹¤ Date.now()ë¥¼ í•´ì„œ ë§Œë“¤ê¸° ë²ˆê±°ë¡œìš°ë‹ˆ Schemaì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆìœ¼ë©´ ì¢‹ê²Ÿë‹¤.

ê·¸ë˜ì„œ defaultë¥¼ ë§¤ê¸´ë‹¤.

  createdAt: { type: Date, required: true, default: Date.now },


ìµœì¢…ì ìœ¼ë¡œ Schemaì˜ í˜•íƒœë¥¼ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

models/Video

import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
  title: { type: String, required: true, trim: true, maxlength: 80 },
  description: { type: String, required: true, trim: true, minlength: 20 },
  createdAt: { type: Date, required: true, default: Date.now },
  hashtags: [{ type: String, trim: true }],
  meta: {
    views: { type: Number, default: 0, required: true },
    rating: { type: Number, default: 0, required: true },
  },
});

const Video = mongoose.model("Video", videoSchema);
export default Video;

home.pug

mixin video(video)
    div
        h4
            a(href=`/videos/${video.id}`)=video.title
        p=video.description
        small=video.createdAt
        hr
        
upload.pug

extends base.pug

block content
    if errorMessage
        span=errorMessage
    form(method="POST")
        input(placeholder="Title", required, type="text", name="title", maxlength=80)
        input(placeholder="Description", required, type="text", name="description", minlength=20)
        input(placeholder="Hashtags, separated by comma.", required, type="text", name="hashtags")
        input(type="submit", value="Upload Video")
        
ì—¬ê¸°ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.




í˜„ì¬ routerë¥¼ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë˜ì–´ìˆë‹¤.

ì§€ì–´ì„œ **Regular Expression(ì •ê·œ í‘œí˜„ì‹)**ì„ ì‚¬ìš©í–ˆë‹¤. í•˜ì§€ë§Œ, MongoDBì—ì„œ ì œê³µí•´ì£¼ëŠ” **idëŠ” 16ì§„ìˆ˜**ë¡œ ë˜ì–´ìˆëŠ” ìƒí™©ì´ë‹¤. ìˆ˜ì •ì´ í•„ìš”í•  ê²ƒ ê°™ë‹¤.






video Detailë³´ì—¬ì£¼ëŠ” pageëŠ” :idë³€ìˆ˜ë¥¼ ì‚¬ìš©í•´ì„œ urlë’¤ì— ë¶™ì—¬ì¤Œìœ¼ë¡œì¨ ë³´ì—¬ì§€ë„ë¡ í•´ë†“ì•˜ë‹¤.

ê·¸ëŸ°ë°, mongooseì—ì„œ ë§Œë“¤ì–´ì£¼ëŠ” ê³ ìœ  IDëŠ” ìˆ«ì ë¬¸ìê°€ ê°™ì´ ì„ì—¬ìˆëŠ” í˜•íƒœì´ë‹¤.

ì¼ë°˜ ì •ê·œ í‘œí˜„ì‹ì€ ì‚¬ìš©í•˜ê¸° ì–´ë µê² ë‹¤.

documentationì—ì„œ mongoDB idì— ëŒ€í•´ ì¡°ì‚¬í•´ì„œ ì´ê±¸ë¡œ regular expressionì„ ë§Œë“¤ì–´ ë³¼ê±°ë‹¤.

idëŠ” 24byte hexadecimal string(24ë°”ì´íŠ¸ 16ì§„ìˆ˜)ë¼ê³  ì •ì˜ë˜ì–´ ìˆë‹¤.

https://www.regexpal.com/ ì—¬ê¸°ì„œ checkí•´ì„œ ë§Œë“¤ì–´ë³´ë©´ëœë‹¤. ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ìˆ˜ ìˆë‹¤.

[0-9a-f]{24}

ì¶”ê°€í•˜ê³  ë‚˜ë©´ watch.pug ë‚´ìš©ì„ ìˆ˜ì •í•˜ë¼ê³  ì˜¤ë¥˜ê°€ ë‚œë‹¤.

Cannot read properties of undefined (reading 'views')

ì´ëŸ° ì˜¤ë¥˜ê°€ ë‚˜ì˜¤ëŠ”ë° ì´ ë§ì€ ì •ì˜ë˜ì§€ ì•Šì€ ë¬´ì—‡ ì•ˆì—ì„œ views ë¥¼ ëª»ì°¾ê³  ìˆìŒì„ ì˜ë¯¸í•œë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 20-37-38.png

í˜„ì¬ controllerì—ì„œ idë§Œ ë°›ê³  videoë¥¼ ì•ˆë„˜ê²¨ ì¤˜ì„œ ê·¸ë ‡ë‹¤.

findOne()ê³¼ findById()ë¥¼ ì´ìš©í•  ê²ƒì´ë‹¤.

findOneì€ ë³´ë‚´ëŠ” ëª¨ë“  conditionì„ ì ìš©ì‹œì¼œì¤€ë‹¤.

findByIdëŠ” idë¡œ ì˜ìƒì„ ì°¾ì•„ë‚¼ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•´ì¤€ë‹¤.

controllerë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•´ì¤€ë‹¤.

videoController.js

export const watch = async (req, res) => {
  const { id } = req.params;
  const video = await Video.findById(id);
  return res.render("watch", { pageTitle: video.title, video });

í•œ ê°€ì§€ ì²˜ë¦¬í•´ì•¼ ë ê²ƒì´ ëˆ„êµ°ê°€ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” videoí˜ì´ì§€ë¥¼ ë°©ë¬¸í–ˆì„ ë•Œ ì–´ë–»ê²Œ í•´ì•¼í•˜ëŠëƒì´ë‹¤.

urlì—ì„œ idë¥¼ ì‚´ì§ ë°”ê¿”ì„œ pageì´ë™ì„ ì‹œë„í•˜ë©´ ë¬´í•œë¡œë”©ì´ ê±¸ë¦°ë‹¤.

ê·¸ ì´ìœ ëŠ” findByIdë¥¼ í†µí•´ì„œ ê°€ì ¸ì˜¤ëŠ” videoê°€ nullê°’ìœ¼ë¡œ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì¦‰, ë¹„ë””ì˜¤ ê²€ìƒ‰ì— ì‹¤íŒ¨í•´ì„œ nullê°’ì„ ê°€ì ¸ì™”ê³  video.titleì„ ìš”ì²­í–ˆì§€ë§Œ ê·¸ videoê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ì„œ nullì´ ë˜ëŠ” error

ê·¸ë˜ì„œ conditionì„ ì‚¬ìš©í•˜ê³  ìƒˆë¡œìš´ Page 404.pugë¥¼ ë§Œë“ ë‹¤.


export const watch = async (req, res) => {
  const { id } = req.params;
  const video = await Video.findById(id);
  if (!video) {
    return res.render("404", { pageTitle: "Video not found." });
  }
  return res.render("watch", { pageTitle: video.title, video });
};

!videoë¥¼ video === nullë¡œ ì¨ë„ ë™ì¼í•˜ê²Œ ì²´í¬ëœë‹¤.

ì—ëŸ¬ë‚¬ì„ ë•Œ ë¶€ë¶„ì„ ifë¬¸ ì•ˆì— ë„£ì–´ì¤Œìœ¼ë¡œì¨ ë‚˜ì¤‘ì— ì½”ë“œë¥¼ ì¶”ê°€í•˜ë”ë¼ë„ ë°‘ì— ë¶™ì—¬ì„œ ì´ì–´ ë‚˜ê°€ê¸° ì‰¬ìš¸ ê²ƒì´ë‹¤.

ë‹¤ìŒì€ edit Pageë¥¼ ì†ë´ì¤„ ì°¨ë¡€ì¸ë°, ê¸°ë³¸ì ì¸ìœ¼ë¡œ idë¥¼ í†µí•´ videoë¥¼ ê°€ì ¸ì™€ì•¼ ë˜ëŠ”ê²ƒì€ ë™ì¼í•˜ë‹¤.

edit.pugë¥¼ ì‚´í´ë³´ì.

extends base.pug

block content 
    h4 Change Title of video 
    form(method="POST") 
        input(name= "title", placehloder="Vidoe Title", type="text", value=video.title, required)
        input(placeholder="Description", required, type="text", value=video.description name="description", minlength=20)
        input(placeholder="Hashtags, separated by comma.", required, type="text", value=video.hashtags,name="hashtags")
        input(value="Save", type="submit")

ì´ê²ƒì˜ ê²°ê³¼ í™”ë©´ì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-17 21-10-28.png

hashtagsê°€ ì €ë ‡ê²Œ ë‚˜ì™€ë²„ë¦°ê²ƒì´ ë¬¸ì œë‹¤. ê·¸ë˜ì„œ ì§€ê¸ˆë¶€í„° hashtagsë¥¼ formatí•´ì¤˜ì•¼í•œë‹¤.

Array -> Stringìœ¼ë¡œ í•˜ë ¤ë©´ ì–´ë–»ê²Œ í•˜ë©´ë ê¹Œ? join()ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. video.hashtags.join()

ì´ì œ updateë¥¼ í•˜ë ¤ê³  formì„ ì „ì†¡í•˜ë©´ POSTë¡œ í•´ì„œ ì „ì†¡ì´ ë ê²ƒì´ê³ , controllerì—ì„œ ì²˜ë¦¬í•˜ë©´ ë ê²ƒì´ë‹¤.

ë¨¼ì € ì²«ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ì¼ì¼íˆ ë‹¤ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ë‹¤. 

export const postEdit = async (req, res) => {
  const { id } = req.params;
  const { title, description, hashtags } = req.body;
  const video = await Video.findById(id);
  if (!video) {
    return res.render("404", { pageTitle: "Video not found." });
  }
  video.title = title;
  video.description = description;
  video.hashtags = hashtags.split(",").map((word) => `#${word}`);
  await video.save();
  return res.render("edit", { pageTitle: `Edit: ${video.title}`, video });
};

í•˜ì§€ë§Œ ì—¬ê¸°ì„œ ì´ìƒíƒœë¡œ í•˜ë©´ ì˜¤ë¥˜ê°€ ë‚ ê²ƒì´ë‹¤. hashtagsì— ì´ë¯¸ #ì´ ë‹¤ ë‹¬ë ¤ìˆê¸° ë•Œë¬¸ì´ë‹¤.
#ì´ ì—†ì„ ë•Œë§Œ í•´ì‹œíƒœê·¸ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ëœë‹¤.

  video.hashtags = hashtags.split(",").map((word) => (word.startsWith("#") ? word : `#${word}`));

ì´ê²ƒì„ í•˜ê³ ë‚˜ë‹ˆ postUploadë¶€ë¶„ë„ ìˆ˜ì •ì„ í•´ì•¼ í•  ê²ƒ ê°™ë‹¤. ë³µì‚¬-ë¶™ì—¬ë„£ê¸°.

ë§¤ìš° ì•ˆì¢‹ë‹¤. ì´ëŸ° ë°©ì‹ì€ ì¢‹ì§€ ì•Šë‹¤.

ì´ ê³¼ì •ì€ êµ‰ì¥íˆ ë²ˆê±°ë¡­ë‹¤. ì½”ë“œì˜ ê¸¸ì´ ì¦‰, formì´ ë§ì•„ì§€ê±°ë‚˜ í•˜ë©´ ë§¤ìš° ë‹¤ë£¨ê¸° ê¹Œë‹¤ë¡­ë‹¤.

findByIdAndUpdate()ë¼ëŠ” functionì— ëŒ€í•´ ì•Œì•„ë³´ì.

https://mongoosejs.com/docs/guide.html

ì´ functionì€ ë‹¤ìŒê³¼ ê°™ì´ ì“°ë©´ëœë‹¤.

ì²«ë²ˆì§¸ Argë¡œ id ë‘ë²ˆì§¸ Argë¡œ ë³€ê²½í•  ë‚´ìš©ì„ ë„£ì–´ì£¼ë©´ ëœë‹¤.

export const postEdit = async (req, res) => {
  const { id } = req.params;
  const { title, description, hashtags } = req.body;
  const video = await Video.findById(id);
  if (!video) {
    return res.render("404", { pageTitle: "Video not found." });
  }
  await Video.findByIdAndUpdate(id, {
    title,
    description,
    hashtags: hashtags
      .split(",")
      .map((word) => (word.startsWith("#") ? word : `#${word}`)),
  });
  return res.redirect(`/videos/${id}`);
};


ì°¸ê³ ë¡œ ëŒ€ë¬¸ì Vì˜ VideoëŠ” Modelì´ê³ , Modelì´ê¸° ë•Œë¬¸ì—, ì—¬ëŸ¬ function ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ê²ƒì´ë‹¤.

ìœ„ì— ì½”ë“œë¥¼ ë³´ë©´ video ì „ì²´ë¥¼ ë‹¤ ê°€ì ¸ì˜¬ í•„ìš”ê°€ ì—†ì–´ì¡Œë‹¤. ê·¸ëƒ¥ ë‹¨ì§€ videoê°€ ìˆëŠ”ì§€ë§Œ ì•Œë©´ ëœë‹¤.

exists()ë¥¼ í™œìš©í•œë‹¤.

exists()ëŠ” IDë¥¼ ë°›ì§€ ì•Šê³ , filterë¥¼ ë°›ëŠ”ë‹¤. 

ì•„ë¬´ëŸ° ì¡°ê±´ì´ë‚˜ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤ëŠ” ê²ƒì´ë‹¤.

  const video = await Video.exists({ _id: id });


í˜„ì¬ ìš°ë¦¬ëŠ” ì˜ìƒ ì—…ë°ì´íŠ¸ë‚˜ ì˜ìƒ ìƒì„±ì„ ìœ„í•´ ì €ì¥í•˜ê¸° ì „ì— í•´ì‹œíƒœê·¸ë“¤ì„ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.

hashtags
      .split(",")
      .map((word) => (word.startsWith("#") ? word : `#${word}`)), 
      ì´ ë¶€ë¶„ì€ Modelì— ì €ì¥í•˜ê¸° ì „ì— ì²˜ë¦¬í•˜ëŠ” ê²ƒë“¤ì¸ë° 
ì˜ìƒì„ ì €ì¥í•˜ê¸° ì „ì— ì—¬ëŸ¬ê°€ì§€ë¥¼ í•  ìˆ˜ ìˆê³ , í•´ì•¼ë§Œ í•œë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ì´ë©”ì¼ ì²´í¬ .. 

Mongooseì—ì„  ì˜ì„±ì„ ì €ì¥, í˜¹ì€ ì—…ë°ì´íŠ¸ ì „ì— ì´ê±°ì €ê±° í•˜ë¼ê³  ì‹œí‚¬ìˆ˜ ìˆë‹¤.

ê·¸ê±¸ Middlewareë¼ê³  í•œë‹¤. Express ì—ì„œ ë³¸ Middlewareë‘ ë˜‘ê°™ì´ Mongooseì—ë„ middlewareê°€ ìˆê³ , pre, post, hookë„ ìˆë‹¤.

ì¤‘ìš”í•œ ê²ƒì€ í‹ˆì„ ë§Œë“¤ì–´ ì£¼ëŠ”ê²ƒì´ê³  ê·¸ê²ƒì€ ë°”ë¡œ ë‹¤ìŒê³¼ ê°™ì´ í•´ì„œ ì¢‹ì€ê²ƒì´ë‹¤.

ì˜ìƒì„ ì €ì¥í•˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ í•  ë•Œ ê·¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ì ì‹œ ì¤‘ë‹¨í•˜ê³ , í•´ì‹œíƒœê·¸ë¥¼ ì²˜ë¦¬í•´ì„œ ë” ê¹”ë”í•˜ê²Œ ì •ë¦¬ë¥¼ í•˜ê³ , í•˜ë˜ê±¸ ë§ˆì € í•˜ëŠ” ê²ƒì´ë‹¤.

ë§Œì•½ Updateí• ë•Œë§ˆë‹¤ ì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤ë©´,
ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 14-14-45.png

í™•ì¸í•´ë³´ë©´, useFindAndModify option set to falseë¼ê³  ì í˜€ìˆë‹¤.

ê·¸ë˜ì„œ useFindAndModifyë¥¼ DBì— ì¶”ê°€í•´ì£¼ë©´ í•´ê²°ëœë‹¤.

Expressì˜ middlewareê°™ì´ íë¦„ì„ ë°©í•´í•˜ì§€ ì•ŠëŠ”ë‹¤.

mongoì•ˆì—ì„œ ë¨¼ì € databaseì— ìˆëŠ” collectionsë¥¼ ì‚­ì œí•˜ê³  ì‹œì‘í•˜ì.

í„°ë¯¸ë„ë¡œê°€ì„œ mongoë¥¼ ì³ì„œ mongoì•ˆìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

ì´í›„ show dbsë¥¼ ì³ì„œ use databaseNameìœ¼ë¡œí•´ì„œ ë“¤ì–´ê°„ë‹¤.

ì´í›„ db.help()ë¥¼ ë³´ë©´ dropì´ ìˆë‹¤.

ì‚­ì œí•´ì£¼ë©´ëœë‹¤ ëª…ë ¹ì–´ì— ë§ê²Œ..

Middlewareëª¨ì–‘ì€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ê°€ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.

shema.pre( 'save' , async function() {} );

'save'ìœ„ì¹˜ì—” Types of Middlewareì´ ë“¤ì–´ê°€ë©´ ëœë‹¤. remove, save, updateOne, deleteOne ...

ì´ì œ models/Videoë¡œ ê°€ì„œ ë§Œë“¤ë©´ ëœë‹¤. 

ì—¬ê¸°ì„œ ì¤‘ìš”í•œ ê²ƒì€ MiddlewareëŠ” ë¬´ì¡°ê±´ modelì´ ìƒì„±ë˜ê¸° ì „ì— ë§Œë“¤ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

í‚¤ì›Œë“œ thisê°€ ìˆëŠ”ë° thisëŠ” ìš°ë¦¬ê°€ ì €ì¥í•˜ê³ ì í•˜ëŠ” ë¬¸ì„œë¥¼ ê°€ë¥´í‚¨ë‹¤.

ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œë¥¼í•˜ê³  ì‹¤í–‰í•˜ë©´ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
  title: { type: String, required: true, trim: true, maxLength: 80 },
  description: { type: String, required: true, trim: true, minLength: 20 },
  createdAt: { type: Date, required: true, default: Date.now },
  hashtags: [{ type: String, trim: true }],
  meta: {
    views: { type: Number, default: 0, required: true },
    rating: { type: Number, default: 0, required: true },
  },
});

videoSchema.pre("save", async function () {
  console.log("We are about to save:", this);
});

const Video = mongoose.model("Video", videoSchema);
export default Video;

ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 14-30-10.png

ê·¸ë ‡ë‹¤ë©´ thisë¥¼ í†µí•´ì„œ ë°”ê¿€ ìˆ˜ ìˆë‹¤.

videoSchema.pre("save", async function () {
  console.log("We are about to save:", this);
  this.title = "Change Title !!!!!!!!HAHAHAH!!"
});

ì´ì™€ ê°™ì´ ë¬´ìŠ¨ titleì„ ì…ë ¥í•˜ë“  ê°„ì— ë‹¤ìŒê³¼ ê°™ì´ ë˜ëŠ”ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 14-33-25.png

ì´ê²ƒì„ ì´ìš©í•´ì„œ hashtagsë¥¼ videoControllerì—ì„œ ì²˜ë¦¬í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ, Middlewareë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

í˜„ì¬ Schemaì—ì„œ hashtagsë¥¼ Array String typeìœ¼ë¡œ ì§€ì •í•´ë†¨ê¸° ë•Œë¬¸ì— Stringìœ¼ë¡œ ì €ì¥ì„ í•˜ë ¤í•´ë„ Arrayë¡œ ì €ì¥ëœë‹¤. í•˜ì§€ë§Œ ìš”ì†Œê°€ í•˜ë‚˜ì¸ ê²ƒìœ¼ë¡œ ì €ì¥ëœë‹¤. ë¶„ë¦¬ê°€ ë˜ì–´ìˆì§€ ì•Šì€ ìƒíƒœì´ë‹¤.

Video.js

import mongoose from "mongoose";

const videoSchema = new mongoose.Schema({
  title: { type: String, required: true, trim: true, maxLength: 80 },
  description: { type: String, required: true, trim: true, minLength: 20 },
  createdAt: { type: Date, required: true, default: Date.now },
  hashtags: [{ type: String, trim: true }],
  meta: {
    views: { type: Number, default: 0, required: true },
    rating: { type: Number, default: 0, required: true },
  },
});

videoSchema.pre("save", async function () {
  this.hashtags = this.hashtags[0]
    .split(",")
    .map((word) => (word.startsWith("#") ? word : `#${word}`));
});

const Video = mongoose.model("Video", videoSchema);

export default Video;

ì´ì™€ ê°™ì´í•´ì„œ 0ë²ˆì§¸ elementë¥¼ êº¼ë‚´ì„œ ë‚˜ëˆ ì¤˜ì„œ ì²˜ë¦¬í•´ì¤Œìœ¼ë¡œì¨ ê°ê° Arrayì•ˆì˜ Elementë¡œ ë“¤ì–´ê°„ë‹¤.

['for, real, now, mongo']	=> ['for', 'real', 'now', 'mongo']


db.videos.remove({})ë¡œ ì‚­ì œ
db.videos.find()

findByIdAndUpdateë¥¼ ìœ„í•œ pre middlewareëŠ” ì—†ë‹¤.

findByIdAndUpdateëŠ” findOneAndUpdateë¥¼ í˜¸ì¶œí•œë‹¤.

findOneAndUpdateë¥¼ ìœ„í•œ middlewareëŠ” ìˆë‹¤.

ë‹¤ë§Œ ë¬¸ì œëŠ”, findOneAndUpdateëŠ” save hookë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.

ê·¸ë¦¬ê³  findOneAndUpdateì—ì„œëŠ” ì—…ë°ì´íŠ¸ í•˜ë ¤ëŠ” ë¬¸ì„œì— ì ‘ê·¼ì„ í•  ìˆ˜ê°€ ì—†ë‹¤.

saveì™€ updateë‘˜ë‹¤ í•„ìš”í•œë° ìœ„ì˜ ë°©ì‹ìœ¼ë¡œëŠ” í•œê³„ê°€ ìˆë‹¤. ë‹¤ë¥¸ë°©ì‹ìœ¼ë¡œ í•´ì•¼í•œë‹¤.

í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ ì£¼ë©´ëœë‹¤. ë‹¤ìŒê³¼ ê°™ì´ í•´ë³´ì.

models/Video

import mongoose from "mongoose";

export const formatHashtags = (hashtags) => {
  hashtags.split(",").map((word) => (word.startsWith("#") ? word : `#${word}`));
};

...


Controller

export const postEdit = async (req, res) => {
  const { id } = req.params;
  const { title, description, hashtags } = req.body;
  const video = await Video.exists({ _id: id });
  if (!video) {
    return res.render("404", { pageTitle: "Video not found." });
  }
  await Video.findByIdAndUpdate(id, {
    title,
    description,
    hashtags: formatHashtags(hashtags),
  });
  return res.redirect(`/videos/${id}`);
};

ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ ëœë‹¤.

Staticì„ ë°°ì›Œë³´ì.

í˜„ì¬ ìš°ë¦¬ëŠ” Video.findById()ë¥¼ êµ‰ì¥íˆ ìì£¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

Video.create()ë„ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

Schema.static( 'ë§Œë“¤ê³ ì í•˜ëŠ” staticì´ë¦„', function() )

videoSchema.static("formatHashtags", function (hashtags) {
  return hashtags
    .split(",")
    .map((word) => (word.startsWith("#") ? word : `#${word}`));
});


controller

      hashtags: Video.formatHashtags(hashtags),
      
ì´ì œ Mixinê°€ì„œ hashtagë¥¼ ë³¼ìˆ˜ ìˆê²Œ í•´ë†“ì.

mixins/video.pug

ì´ì œ deleteë¥¼ ë§Œë“¤ê±´ë° ì´ê²ƒì€ í…œí”Œë¦¿, ì»¨íŠ¸ë¡¤ëŸ¬, ë¼ìš°í„° ì „ë¶€ ì‚¬ìš©í•˜ê²Œ ë  ê²ƒì´ë‹¤.

1. watchë¡œ ê°€ì„œ delete pageë¡œ ê°ˆ ìˆ˜ ìˆëŠ” linkë§Œë“¤ì–´ ì£¼ê¸°

2. postë¡œ í•˜ì§€ ì•Šê³  URLì„ ë°©ë¬¸í•˜ì—¬ì„œ ì‚­ì œí•˜ê²Œë” ë§Œë“ ë‹¤.
=> functionì˜ ë¼ìš°í„°ì™€ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“¤ì–´ì•¼ í•œë‹¤.

3. controllerì— functionêµ¬í˜„í•´ì£¼ê³  redirectë¡œ home("/")ìœ¼ë¡œ ë³´ë‚´ì£¼ë©´ ëœë‹¤.
=> 
export const deleteVideo = async (req, res) => {
  const { id } = req.params;
  await Video.findByIdAndDelete(id);
  return res.redirect("/");
};

findOneAndDeleteëŠ” findOneAndRemoveë‘ ì¡°ê¸ˆ ë‹¤ë¥´ë‹¤.

ê°„ë‹¨íˆ ë§í•˜ë©´, findOneAndDeleteë¥¼ ì¨ì•¼í•œë‹¤.

findOneAndDelete({ _id:id})ë¥¼ ì¤„ì¸ê²ƒì´ findByIdAndDelete(id)ì´ë‹¤.

ì—¬ëŸ¬ê°€ì§€ í•  ìˆ˜ ìˆëŠ”ê²ƒì„ ë´¤ë‹¤. ì •ë ¬ë„ ê°€ëŠ¥í•˜ë‹¤. ë‹¤ìŒê³¼ ê°™ì´ í•´ë³´ì.

export const home = async (req, res) => {
  const videos = await Video.find({}).sort({ createdAt: "desc" });
  return res.render("home", { pageTitle: "Home", videos });
};

descëŠ” ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ descendingì˜ ì¤„ì„ë§ì´ê³ , ascëŠ” ascendingì˜ ì•½ìë¡œ ì˜¤ë¦„ì°¨ìˆœì´ë‹¤.

ì €ì¥í• ë•Œ hashtagê°€ í•˜ë‚˜ë§Œ ì €ì¥ë˜ê³  editë¥¼ í•˜ë©´ ì˜¬ë°”ë¥´ê²Œ ì €ì¥ë˜ì„œ ë¨¸ê°€ ë¬¸ì œì¸ê°€ ë´¤ë”ë‹ˆ ë‹¤ìŒì´ ë¬¸ì œì˜€ë‹¤.

videoSchema.static("formatHashtags", function (hashtags) {
  return hashtags
    .split(",")
    .map((word) => (word.startsWith("#") ? word : `#${word}`));
});

videoSchema.pre("save", async function () {
  this.hashtags = this.hashtags[0]
    .split(",")
    .map((word) => (word.startsWith("#") ? word : `#${word}`));
});

models/Videoì—ì„œ ì´ë ‡ê²Œ ë˜ì–´ ìˆì—ˆëŠ”ë° ì €ì¥ê³¼ì •ì—ì„œ splitì—ì„œ hashtagë¥¼ ê° elementë¡œ ë‚˜ëˆ ì„œ Arrayì— ë„£ì—ˆëŠ”ë° ë˜ í•œë²ˆ ë”í•´ì„œ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

Search í˜ì´ì§€ë¥¼ ë§Œë“¤ê±´ë° ì–´ëŠ routerì— í•´ì•¼í• ê¹Œ?

globalRouterì—ì„œ í•´ì•¼í•œë‹¤.

viewì— ë§Œë“¤ê³  homepageì—ì„œ linkë¥¼ ë§Œë“¤ì–´ ì´ë™í•  ìˆ˜ ìˆê²Œ í•´ë†“ëŠ”ë‹¤. ê·¸ë¦¬ê³  search.pugë¥¼ ë§Œë“ ë‹¤.

search.pug

extends base.pug

block content 
  form(method="GET") 
    input(type="text", name="keyword", placeholder="Serach by title...")
    input(type="submit", value="Search now")
    
ë‹¤ìŒê³¼ ê°™ì´ í–ˆìœ¼ë©´ controller.jsê°€ì„œ keywordë¥¼ req.query ë¥¼í†µí•´ì„œ ë°›ì•„ì˜¨ë‹¤.

export const search = (req, res) => {
  const { keyword } = req.query;
  return res.render("search", { pageTitle: "Search" });
}; 

ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼ ë ê²ƒì€, keywordê°€ í•­ìƒ ìˆëŠ”ê²ƒì´ ì•„ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ home pageì—ì„œ searchë¡œ ì´ë™í•˜ë©´ keywordë¡œ ê°€ì ¸ì˜¤ëŠ” ê°’ì€ undefinedì´ë‹¤.

ë‹¹ì—°íˆ SearchëŠ” databaseì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ì„œ Mongoose, MongoDBì™€ ì†Œí†µí•˜ê¸° ìœ„í•´ì„œ ìš°ë¦¬ê°€ ì‚¬ìš©í•´ì•¼ í•  ê²ƒì€ asyncë‘ awaitì´ë‹¤.

export const search = (req, res) => {
  const { keyword } = req.query;
  if (keyword) {
    const videos = await Video.find({
      title: keyword,
    });
    return res.render("search", {pageTitle:"Search", videos})
  }
  return res.render("search", { pageTitle: "Search" });
};


ì´ëŸ°ì‹ìœ¼ë¡œ í•´ì£¼ë©´ ë˜ê² ë‹¤.

ìœ„ì—êº¼ì˜ ë¬¸ì œì ì€ search.pugë¥¼ ë³´ë©´ mixinë¥¼ ì‚¬ìš©í•´ì„œ videosë¥¼ ë°›ê³  ìˆê¸´í•œë° ì§€ê¸ˆ ìœ„ì—ì²˜ëŸ¼í•˜ë©´ ì²˜ìŒ Search Pageë¡œ ì´ë™í–ˆì„ ë•Œ ë³€ìˆ˜ ì„ ì–¸ì¡°ì°¨ ë˜ì–´ ìˆì§€ ì•Šì€ ìƒí™©ì´ë‹¤. each video in videosì—ì„œ ë¬¸ì œê°€ ìƒê¸°ëŠ” ê±°ì„.

ë˜ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ ë§ì´ë‹¤.

export const search = async (req, res) => {
  const { keyword } = req.query;
  let videos = [];
  if (keyword) {
    videos = await Video.find({
      title: {
        $regex: new RegExp(`${keyword}`, "i"),
      },
    });
  }
  return res.render("search", { pageTitle: "Search", videos });
};



ë‹¤ìŒì€ ì‚´í´ë³´ì.
export const search = (req, res) => {
  const { keyword } = req.query;
  if (keyword) {
    const videos = await Video.find({
      title: keyword,
    });
  }
    return res.render("search", {pageTitle:"Search", videos})
};
ì—¬ê¸°ì„œ ë¨¸ê°€ ë¬¸ì œì¸ì§€ë¥¼ ì•Œì•„ì•¼ í•œë‹¤.

í˜„ì¬ videosëŠ” í˜„ì¬   if (keyword) {
    const videos = await Video.find({
      title: keyword,
    });
  }ì´ ì•ˆì—ì„œ ì •ì˜ê°€ ëë‹¤. ê·¸ë˜ì„œ ë°–ì— ì™€ëŠ” ê³µìœ ë˜ì–´ ìˆì§€ ì•Šì€ ìƒíƒœì´ë‹¤. 
  
ì¦‰, constëŠ” ì´ ifë¬¸ ì•ˆì—ì„œë§Œ ì¡´ì¬í•˜ëŠ” ê²ƒì´ë‹¤.
  
search.pugë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ë©´ ëœë‹¤.

extends base.pug
include mixins/video

block content 
  form(method="GET") 
    input(type="text", name="keyword", placeholder="Serach by title...")
    input(type="submit", value="Search now")
    
  div 
    each video in videos 
      +video(video)
      
      
ì´ ë°©ì‹ì˜ ë¬¸ì œì ì€ ì œëª©ì„ ì™„ì „íˆ ì •í™•í•˜ê²Œ ì¨ì•¼í•œë‹¤ëŠ” ì ì´ë‹¤.

ê·¸ë˜ì„œ regular expressionì„ ì‚¬ìš©í•  ìˆ˜ ìˆê² ë‹¤.

ì°¾ê³  ì‹¶ì€ ë‹¨ì–´ë¡œ ëë‚˜ëŠ” ì œëª©ì„ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?
word$

ë°˜ëŒ€ë¡œ ì‹œì‘í•˜ëŠ” ì œëª©ì„ ê²€ìƒ‰í•˜ê³  ì‹¶ë‹¤ë©´?
^word


ì´ê±¸ í•˜ê¸° ìœ„í•´ì„  regexë¼ëŠ” ì—°ì‚°ì(operator)ë¥¼ ì¨ì•„í–”ë‹¤. regular expressionì˜ ì•½ìë‹¤.


iì˜ ê²½ìš° ëŒ€ë¬¸ì ì†Œë¬¸ì êµ¬ë¶„ ì—†ê²Œ í•´ì¤€ë‹¤.

ì´ë ‡ê²Œ regular expressionì•ˆì— keywordë¥¼ ì§‘ì–´ ë„£ìœ¼ë©´ contain ë°©ì‹ì˜ regular expressionì„ ìƒì„±í•˜ê²Œ ëœë‹¤.

ê·¸ ë§ì€, ì œëª©ì— keywordë¥¼ í¬í•¨í•˜ëŠ” ì˜ìƒë“¤ì„ ì°¾ì„ ê²ƒì´ë‹¤ë¼ëŠ” ë§ì´ë‹¤.

ì´ê²Œ containsì´ë‹¤.

const videos = await Video.find({
  title: {
    $regex: new RegExp(`${keyword}`, "i"),
  },
});
    
    
ì•„ë‹ˆë©´ keywordë¡œ ì‹œì‘í•˜ëŠ” ì œëª©ë§Œ í•˜ë ¤ë©´?


const videos = await Video.find({
  title: {
    $regex: new RegExp(`^${keyword}`, "i"),
  },
});

ì´ê²ƒìœ¼ë¡œ CRUD Create, Read, Update, Deleteê°€ ì™„ì„±ëë‹¤.

export const home = (req, res) => {
  const movies = Movie.find({});
  console.log(movies);
  return res.render("home", { pageTitle: "Home", movies });
};

ì—¬ê¸°ì„œ ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì¶œë ¥ë˜ë©´ì„œ ì˜¤ë¥˜ê°€ ë‚˜ê³  databaseì— ì¶”ê°€í•œê²ƒì„ ì¬ëŒ€ë¡œ ëª»ë¶ˆëŸ¬ì˜¨ë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 22-52-38.png

ë‹¤ìŒê³¼ ê°™ì´ í•´ì•¼í•œë‹¤

export const home = async (req, res) => {
  const movies = await Movie.find({});
  console.log(movies);
  return res.render("home", { pageTitle: "Home", movies });
};

ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 22-53-19.png

ê·¸ë¦¬ê³  _idì²˜ëŸ¼ ë˜ì–´ìˆì§€ë§Œ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ idë¥¼ ë¶ˆëŸ¬ì˜¬ë•Œ movie.idë¡œ í•´ë„ ë¶ˆëŸ¬ì™€ì§„ë‹¤.

vscodeë¡œëŠ” ë˜ëŠ”ë° blueprintë¡œ ì˜®ê¸°ê³  ë‚˜ë‹ˆ ì´ëŸ° ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

ìŠ¤í¬ë¦°ìƒ·, 2022-01-18 23-45-44.png

ì´ë ‡ê²Œí•˜ë©´ ì˜¤ë¥˜ê°€ ì•ˆë‚œë‹¤.

export const postEdit = async (req, res) => {
  const { id } = req.params;
  const { title, summary, year, genres } = req.body;
  const movie = await Movie.findById(id);
  if (!movie) {
    return res.render("/", { pageTitle: "Video not found." });
  }
  await Movie.findByIdAndUpdate(id, {
    title,
    summary,
    year,
    genres: Movie.formatGenres(genres)
  });
  return res.redirect("/");
};

ì´ë ‡ê²Œ í•˜ë©´ ì˜¤ë¥˜ê°€ ë‚œë‹¤.

export const postEdit = async (req, res) => {
  const { id } = req.params;
  const { title, summary, year, genres } = req.body;
  const movie = await Movie.findById(id);
  if (!movie) {
    return res.render("/", { pageTitle: "Video not found." });
  }
    await Movie.findByIdAndUpdate(id, {
      title,
      summary,
      year,
      genres: Movie.formatGenres(genres)
    });
    return res.redirect(`/movies/${movie.id}`);
};

ê°‘ìê¸° ëœë‹¤  í•˜ ..............................................


